apiVersion: v1
kind: Secret
metadata:
  name: {{ include "microdatacenter.fullname" . }}-secrets
  labels:
    {{- include "microdatacenter.labels" . | nindent 4 }}
type: Opaque
data:
  # Database password
  db-password: {{ .Values.secrets.dbPassword | default (randAlphaNum 32) | b64enc | quote }}
  
  # Database connection string (full connection string)
  db-connection-string: {{ .Values.secrets.dbConnectionString | b64enc | quote }}
  
  # Keycloak Admin Credentials
  keycloak-admin-user: {{ .Values.secrets.keycloakAdmin.username | b64enc | quote }}
  keycloak-admin-password: {{ .Values.secrets.keycloakAdmin.password | default (randAlphaNum 32) | b64enc | quote }}
  
  # Keycloak Database Password (can be same as main DB or different)
  keycloak-db-password: {{ .Values.secrets.keycloakDbPassword | default (randAlphaNum 32) | b64enc | quote }}
  
  # JWT and API Secrets
  jwt-secret: {{ .Values.secrets.jwtSecret | default (randAlphaNum 64) | b64enc | quote }}
  api-secret: {{ .Values.secrets.apiSecret | default (randAlphaNum 32) | b64enc | quote }}
  
  {{- if .Values.secrets.proxmoxCredentials.tokenId }}
  # Proxmox API Token Credentials
  proxmox-token-id: {{ .Values.secrets.proxmoxCredentials.tokenId | b64enc | quote }}
  proxmox-secret: {{ .Values.secrets.proxmoxCredentials.secret | b64enc | quote }}
  proxmox-base-url: {{ .Values.secrets.proxmoxCredentials.baseUrl | b64enc | quote }}
  {{- end }}

{{- range $secretName, $secretData := .Values.secrets.additional }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "microdatacenter.fullname" $ }}-{{ $secretName }}
  labels:
    {{- include "microdatacenter.labels" $ | nindent 4 }}
type: Opaque
data:
  {{- range $key, $value := $secretData }}
  {{ $key }}: {{ $value | b64enc | quote }}
  {{- end }}
{{- end }}